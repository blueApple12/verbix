<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verbix</title>

<style>
body {
    margin: 0;
    padding: 0;
    background: radial-gradient(circle, #2b1407, #120804 70%);
    color: #ffdca8;
    font-family: Georgia, serif;
    text-align: center;
    overflow: hidden;
}

#title {
    margin-top: 40px;
    font-size: 42px;
    letter-spacing: 3px;
    text-shadow: 0 0 12px #ffbf66;
}

#startBtn {
    margin-top: 70px;
    padding: 16px 45px;
    font-size: 24px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(180deg, #ffda8b, #d69a3c);
    color: #4a2a0f;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 20px #ffcf70;
}

#blackout {
    position: fixed;
    inset: 0;
    background: black;
    z-index: 9999;
    display: none;
}
</style>
</head>

<body>

<h1 id="title">VERBIX</h1>
<button id="startBtn">Begin</button>
<div id="blackout"></div>

<script>
const $ = id => document.getElementById(id);

// ======================
// Speech Recognition
// ======================
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;
let listening = false;

const TRIGGER = "אמרתי לך לחשוב על";

if (SR) {
    recognition = new SR();
    recognition.lang = "he-IL";
    recognition.continuous = true;
    recognition.interimResults = true;

    recognition.onresult = e => {
        const text = e.results[e.results.length - 1][0].transcript.trim();
        handleSpeech(text);
    };

    recognition.onerror = restartListening;
    recognition.onend = restartListening;
}

function startListening() {
    if (!recognition || listening) return;
    listening = true;
    recognition.start();
}

function restartListening() {
    if (!listening) return;
    try {
        recognition.start();
    } catch {}
}

function handleSpeech(text) {
    const idx = text.indexOf(TRIGGER);
    if (idx === -1) return;

    const after = text.slice(idx + TRIGGER.length).trim();
    if (!after) return;

    const word = after.split(/\s+/)[0];
    if (!word) return;

    // STOP EVERYTHING and search
    listening = false;
    recognition.stop();

    location.href =
        "https://www.google.com/search?q=" +
        encodeURIComponent(word);
}

// ======================
// Fullscreen + Start
// ======================
async function goFullscreen() {
    try { await document.documentElement.requestFullscreen(); } catch {}
}

$("startBtn").onclick = async () => {
    await goFullscreen();
    $("blackout").style.display = "block";
    $("title").style.display = "none";
    $("startBtn").style.display = "none";
    startListening();
};
</script>

</body>
</html>
